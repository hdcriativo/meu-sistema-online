"use client";

import { useState, useMemo } from 'react';
import { AppLayout } from '@/components/layout/app-layout';
import { Card, CardHeader, CardTitle, CardContent, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { DataTable } from '@/components/ui/data-table';
import { mockUsers } from '@/lib/mock-data';
import type { User } from '@/lib/types';
import { Users, ShieldAlert, PlusCircle } from 'lucide-react';
// ðŸš¨ CAMINHO CRÃTICO: Verifique se a pasta Ã© 'usuarios' (minÃºsculo)
import { NewUserDialog } from '@/components/usuarios/NewUserDialog'; 

// --- FUNÃ‡Ã•ES AUXILIARES ---
const roleVariant = (role: string): "default" | "concluido" | "recusado" | "em_andamento" => {
Â  switch (role) {
Â  Â  case "admin": return "recusado";
Â  Â  case "vendedor": return "em_andamento";
Â  Â  case "motorista": return "concluido";
Â  Â  default: return "default";
Â  }
}

// --- DEFINIÃ‡ÃƒO DAS COLUNAS DA DATATABLE ---
const columns = [
Â  {
Â  Â  accessorKey: "name",
Â  Â  header: "Nome",
Â  },
Â  {
Â  Â  accessorKey: "email",
Â  Â  header: "Email de Login",
Â  },
Â  {
Â  Â  accessorKey: "role",
Â  Â  header: "Perfil",
Â  Â  cell: ({ row }: { row: any }) => (
Â  Â  Â  <Badge variant={roleVariant(row.original.role as string)}>
Â  Â  Â  Â  {row.original.role.toUpperCase()}
Â  Â  Â  </Badge>
Â  Â  ),
Â  },
Â  {
Â  Â  accessorKey: "id",
Â  Â  header: "ID",
Â  Â  cell: ({ row }: { row: any }) => `#${row.original.id.toUpperCase()}`,
Â  },
];

// --- COMPONENTE PRINCIPAL ---
export default function AdminUsuariosPage() {
Â  Â  // Estado para a lista de usuÃ¡rios
Â  Â  const [allUsers, setAllUsers] = useState<User[]>(mockUsers); 

Â  Â  // Handler para adicionar novo usuÃ¡rio
Â  Â  const handleNewUser = (newUserData: any) => { 
Â  Â  Â  Â  const newUser: User = {
Â  Â  Â  Â  Â  Â  id: newUserData.id,
Â  Â  Â  Â  Â  Â  name: newUserData.name,
Â  Â  Â  Â  Â  Â  email: newUserData.email,
Â  Â  Â  Â  Â  Â  role: newUserData.role,
Â  Â  Â  Â  Â  Â  isPendingApproval: false,
Â  Â  Â  Â  Â  Â  isActive: true,
Â  Â  Â  Â  Â  Â  empresaId: "empresa-1",
Â  Â  Â  Â  Â  Â  avatarUrl: "/avatars/default.png", 
Â  Â  Â  Â  Â  Â  createdAt: new Date(), 
Â  Â  Â  Â  };
Â  Â  Â  Â  setAllUsers(prev => [newUser, ...prev]);
Â  Â  }
Â  
Â  // Dados atualizados para a tabela
Â  const usersData = useMemo(() => allUsers, [allUsers]);

Â  return (
Â  Â  <AppLayout>
Â  Â  Â  <div className="p-8 max-w-7xl mx-auto space-y-6">
Â  Â  Â  Â  
Â  Â  Â  Â  <div className="flex justify-between items-center">
Â  Â  Â  Â  Â  <h1 className="text-3xl font-bold flex items-center">
Â  Â  Â  Â  Â  Â  <ShieldAlert className="h-7 w-7 mr-3 text-red-600" />
Â  Â  Â  Â  Â  Â  GestÃ£o de UsuÃ¡rios (Admin)
Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  {/* ðŸ’¥ USO DO MODAL: Isso renderiza o botÃ£o funcional */}
Â  Â  Â  Â  Â  <NewUserDialog onSuccess={handleNewUser} /> 
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <Card>
Â  Â  Â  Â  Â  <CardHeader>
Â  Â  Â  Â  Â  Â  <CardTitle>Lista Completa de UsuÃ¡rios</CardTitle>
Â  Â  Â  Â  Â  Â  <CardDescription>
Â  Â  Â  Â  Â  Â  Â  Â  Esta tela Ã© visÃ­vel apenas para usuÃ¡rios com o perfil 'admin'.
Â  Â  Â  Â  Â  Â  </CardDescription>
Â  Â  Â  Â  Â  </CardHeader>
Â  Â  Â  Â  Â  <CardContent>
Â  Â  Â  Â  Â  Â  <DataTable 
Â  Â  Â  Â  Â  Â  Â  Â  columns={columns} 
Â  Â  Â  Â  Â  Â  Â  Â  data={usersData} 
Â  Â  Â  Â  Â  Â  Â  Â  filterColumn="name" 
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </CardContent>
Â  Â  Â  Â  </Card>
Â  Â  Â  </div>
Â  Â  </AppLayout>
Â  );
}
